=============
Copy Database
=============

Copy Rename Move Databases

Database transfer without intermediate file

.. default-domain:: mongodb

Sypnosis
--------

This document oulines the procedure to copy MongoDB databases from one
server to another using the :program:`copydb` command. The copy
database function in MongoDB can help you in several situations such
as: renaming a database, migrating databases between servers, and
seeding development from an existing data set for test
environments. The :program:`copydb` commands may be run on a
:term:`secondary` member.

While :program:`mongodump` and :program:`mongorestore` tools are
available, the copy database commands are faster as there is no
intermediate files to be created.

.. warning::
   
   These copy procedures do not lock the database so writes may still
   occur during the copy process at the source. This will produce a
   destination database which is inconsistent with the source
   database.

.. TODO find alternatives to this? 
..   mongodump / mongorestore
..   disconnect the DB from the network?
..   perform lock by hand?
..   Other references? -> mongodump / mongorestore tutorials
..   mongolock function

.. TODO link to collections/databases terminology page - so people
.. don't get confused with 'mongo database' vs. traditional database terms.

.. TODO literals, should they stay literals throughout the doc? even
.. in the code examples too?

Limitations
-----------

- These commands must be run on the destination server.

- These commands do not work with the total data set of a :term:`shard
  cluster`.

- There must be enough free disk storage on the destination server for the
  database from the source server.

Copy a Database from a Server
-----------------------------

To copy database named ``databaseA`` on server ``db1.example.net`` to
another server ``db2.example.net`` naming it to ``databaseB``.

- Verify name of database, ``databaseA``, you want to copy on the source
  server, ``db1.example.net``.

- Log onto the destination server, ``db2.example.net``.

- Run the following command from :program:`mongo shell` on the
  destination server, ``db2.example.net``.

   .. code-block:: javascript

      db.copyDatabase( "databaseA", "databaseB", "db1.example.net")

Copy a Database within a Server
-------------------------------

To rename a database from ``databaseA`` to ``databaseB`` within the
same server, ``db2.example.net``.

- Log onto the destination server, ``db2.example.net``.

- Run the following command from :program:`mongo shell` on the
  destination server, ``db2.example.net``.

   .. code-block:: javascript

      db.copyDatabase( "databaseA", "databaseB")

Copy a Database with Authentication
-----------------------------------

To copy ``databaseA`` to ``databaseB`` using ``username`` and
``password`` authentication from the source server, ``db1.example.net``
to ``db2.example.net`` use the following procedure.

.. TODO reword this so it's not so LONG and contrived.

- Log onto the destination server, ``db2.example.net``.

- Run the following command from :program:`mongo shell` on the
  destination server, ``db2.example.net``.

   .. code-block:: javascript

      db.copyDatabase( "databaseA", "databaseB", "db1.example.net",
                      ``username``, ``password``)
		   
Copy a Database Using CloneDatabase Command
-------------------------------------------

:program:`cloneDatabase` is similar to :program:`copyDatabase` but has
a simplified syntax to copy a database from another server while
preserving the database name.

To copy a database from ``db1.example.net`` to ``db2.example.net``,
on ``db2.example.net`` follow these procedures.

- Log onto the destination server, ``db2.example.net``.

- Run the following command from :program:`mongo shell` on the
  destination server, ``db2.example.net``.

   .. code-block:: javascript

      db.cloneDatabase( "``db1.example.net``" )
