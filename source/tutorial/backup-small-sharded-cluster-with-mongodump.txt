=================================================
Backup a Small Sharded Cluster with ``mongodump``
=================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

Overview
--------

If your :term:`sharded cluster` holds a small data set, you can
connect to a :binary:`~bin.mongos` using :binary:`~bin.mongodump`. You can
create backups of your MongoDB cluster, if your backup infrastructure
can capture the entire backup in a reasonable amount of time and if
you have a storage system that can hold the complete MongoDB data set.

See :doc:`/core/backups` and
:doc:`/administration/backup-sharded-clusters` for a complete
information on backups in MongoDB and backups of sharded clusters in
particular.

.. important:: By default :binary:`~bin.mongodump` issue its queries to
   the non-primary nodes.

Considerations
--------------

If you use :binary:`~bin.mongodump` without specifying a database
or collection, :binary:`~bin.mongodump` will capture collection data
*and* the cluster meta-data from the :ref:`config servers
<sharding-config-server>`.

You cannot use the :option:`--oplog <mongodump --oplog>` option for
:binary:`~bin.mongodump` when capturing data from
:binary:`~bin.mongos`. As a result, if you need to capture a backup that
reflects a single moment in time, you must stop all writes to the
cluster for the duration of the backup operation.

Procedure
---------

Capture Data
~~~~~~~~~~~~

You can perform a backup of a :term:`sharded cluster` by connecting
:binary:`~bin.mongodump` to a :binary:`~bin.mongos`. Use the following
operation at your system's prompt:

.. code-block:: sh

   mongodump --host mongos3.example.net --port 27017

:binary:`~bin.mongodump` will write :term:`BSON` files that hold a copy of
data stored in the :term:`sharded cluster` accessible via the
:binary:`~bin.mongos` listening on port ``27017`` of the
``mongos3.example.net`` host.

Restore Data
~~~~~~~~~~~~

Backups created with :binary:`~bin.mongodump` do not reflect the chunks or
the distribution of data in the sharded collection or
collections. Like all :binary:`~bin.mongodump` output, these backups
contain separate directories for each database and :term:`BSON` files
for each collection in that database.

You can restore :binary:`~bin.mongodump` output to any MongoDB instance,
including a standalone, a :term:`replica set`,  or a new
:term:`sharded cluster`. When restoring data to sharded cluster, you
must deploy and configure sharding before restoring data from the
backup. See :doc:`/tutorial/deploy-shard-cluster` for more information.
