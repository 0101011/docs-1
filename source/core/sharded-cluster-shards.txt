=============
Shard Servers
=============

.. default-domain:: mongodb

.. TODO Intro paragraph .. following is just a placeholder.

A shard is a :term:`replica set` or a single :program:`mongod` that
contains a subset of the data for the sharded cluster. Together, the
cluster's shards hold the entire data set for the cluster.

Typically each shard is a replica set. Each replica set consists of
multiple :program:`mongod` instances. The members of the replica set
provide redundancy and high availability for the data in each shard.

.. important:: MongoDB enables data :term:`partitioning <partition>`,
   or sharding, on a *per collection* basis. You *must* access all
   data in a sharded cluster via the :program:`mongos` instances as
   below.  If you connect directly to a :program:`mongod` in a sharded
   cluster you will see its fraction of the cluster's data. The data
   on any given shard may be somewhat random: MongoDB provides no
   guarantee that any two contiguous chunks will reside on a single
   shard.

Primary Shard
-------------

Every database has a "primary" [#overloaded-primary-term]_ shard that
holds all un-sharded collections in that database. All *un-sharded*
collections reside on the primary shard for their database.

.. include:: /images/sharded-cluster-primary-shard.rst

To change the primary shard for a database, use the
:dbcommand:`movePrimary` command.

.. warning::

   The :dbcommand:`movePrimary` command can be expensive because it
   copies all non-sharded data to the new shard, during which time,
   that data will be unavailable for other operations.

When you deploy a new :term:`sharded cluster`, the "first shard" becomes
the primary for all databases before enabling sharding. Databases
created subsequently, may reside on any shard in the cluster.

Shard Status
------------

Use the :method:`sh.status()` method in the :program:`mongo` shell to
see an overview of the cluster, including information about the
primary shard for the database, which database has sharding enabled,
and the :term:`chunk` and database distribution within the clusterl.

.. [#overloaded-primary-term] The term "primary" in the context of
   databases and sharding has nothing to do with the term
   :term:`primary` in the context of :term:`replica sets <replica set>`.
